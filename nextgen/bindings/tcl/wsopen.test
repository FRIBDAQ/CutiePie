#
#  Tests for the ::spectcl::wsOpen command.
#
package require tcltest
package require sqlite3

load .libs/libSpecTclExperiment.so
namespace import ::tcltest::*

#--------------------------- The tests ---------------------

test exists {The command wsOpen must exists in the ::spectcl:: namespace} \
    -body {
	set result [info commands ::spectcl::wsOpen]
    } -result ::spectcl::wsOpen


test error_1 {wsOpen requires a path parameter} \
    -body {
	set result [catch ::spectcl::wsOpen msg]
	list $result $msg
    } -result [list 1 "Incorrect number of command line parameters"]

test error_2 {wsOpen rquires a database that is a workspace} \
    -setup {
	file delete ./junk.db
	sqlite3 db ./junk.db
    } \
    -cleanup {
	db close
	file delete ./junk.db
    } \
    -body {
	set result [catch {::spectcl::wsOpen ./junk.db} msg]
	list $result $msg

    } -result [list 1  "NOT_WORKSPACE - The database is not a workspace"]

test test_ok {wsOpen should give a handle when it works} \
    -setup {
	file delete ./expdb.db
	file delete ./ws.db

	set expHandle [::spectcl::expcreate ./expdb.db]
	::spectcl::wsCreate $expHandle ./ws.db
    } \
    -cleanup {
	::spectcl::expclose $expHandle
	file delete ./expdb.db
	file delete ./ws.db;	# Need to close first in theory...chicken & egg problem.
    } \
    -match glob \
    -body {
	set result [catch [list ::spectcl::wsOpen ./ws.db] msg]
	if {$result} {
	    set result [list $result $msg]
	} else {
	    set result $msg
	}
	set result
    } -result spectcl_*

cleanupTests