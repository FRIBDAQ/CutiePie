<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>CEventProcessor</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="SpecTcl Programming Reference."
HREF="index.html"><LINK
REL="UP"
TITLE="Core SpecTcl classes"
HREF="p8474.html"><LINK
REL="PREVIOUS"
TITLE="Core SpecTcl classes"
HREF="p8474.html"><LINK
REL="NEXT"
TITLE="CEventBuilderEventProcessor"
HREF="r8671.html"></HEAD
><BODY
CLASS="refentry"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>SpecTcl Programming Reference.</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="p8474.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="r8671.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="AEN8479"
></A
>CEventProcessor</H1
><DIV
CLASS="refnamediv"
><A
NAME="AEN8483"
></A
><H2
>Name</H2
>CEventProcessor&nbsp;--&nbsp;Abstract base class convering events to parameters</DIV
><DIV
CLASS="refsynopsisdiv"
><A
NAME="AEN8486"
></A
><H2
>Synopsis</H2
><PRE
CLASS="synopsis"
>&#13;#include &#60;EventProcessor.h&#62;

class CEventProcessor {
 public:
  virtual Bool_t operator()(const Address_t pEvent,
                            CEvent&#38; rEvent,
                            CAnalyzer&#38; rAnalyzer,
                            CBufferDecoder&#38; rDecoder); 
  virtual Bool_t OnAttach(CAnalyzer&#38; rAnalyzer);
  virtual Bool_t OnBegin(CAnalyzer&#38; rAnalyzer,
                         CBufferDecoder&#38; rDecoder);
  virtual Bool_t OnEnd(CAnalyzer&#38; rAnalyzer,
                       CBufferDecoder&#38; rBuffer); 
  virtual Bool_t OnPause(CAnalyzer&#38; rAnalyzer,
                         CBufferDecoder&#38; rDecoder); 
  virtual Bool_t OnResume(CAnalyzer&#38; rAnalyzer,
                          CBufferDecoder&#38; rDecoder);
  virtual Bool_t OnOther(UInt_t nType,
                         CAnalyzer&#38; rAnalyzer,
                         CBufferDecoder&#38; rDecoder);

  virtual Bool_t OnEventSourceOpen(std::string name);
  virtual Bool_t OnEventSourceEOF();
  virtual Bool_t OnInitialize();
};

            </PRE
></DIV
><DIV
CLASS="refsect1"
><A
NAME="AEN8488"
></A
><H2
>DESCRIPTION</H2
><P
>&#13;                    <CODE
CLASS="classname"
>CEventProcessor</CODE
> Provides the abstract
                    base class for elements of the event processing pipeline.
                    Tailoring SpecTcl to analyze a particular dataset involves
                    writing a set of classes derived from
                    <CODE
CLASS="classname"
>CEventProcessor</CODE
> and registering instances
                    of those classes in
                    <CODE
CLASS="classname"
>MySpecTclApp::</CODE
><CODE
CLASS="methodname"
>CreateAnalysisPipeline</CODE
>.
                </P
><P
>&#13;                    Each element of the pipeline normally contributes elements
                    to the event array either directly or indirectly through
                    tree parameters.  These elements, or parameter values, either
                    come from decoding segments of the raw event, or by performing
                    computations on existing parameter values.
                </P
><P
>&#13;                    Event processors that decode sections of the raw event are
                    often referred to as <I
CLASS="firstterm"
>unpackers</I
>.
                </P
></DIV
><DIV
CLASS="refsect1"
><A
NAME="AEN8498"
></A
><H2
>METHODS</H2
><P
>&#13;                    Note that the methods of <CODE
CLASS="classname"
>CEventProcessor</CODE
>
                    are all virtual methods that have default implementations
                    that return <TT
CLASS="literal"
>kfTRUE</TT
>.  All methods return
                    a <SPAN
CLASS="type"
>Bool_t</SPAN
>.  A return value of <TT
CLASS="literal"
>kfTRUE</TT
>
                    indicates success.  A value of <TT
CLASS="literal"
>kfFALSE</TT
>
                    indicates failure.  A failure return aborts the event processing
                    pipeline. This means that no more event processors will be called
                    and, for <CODE
CLASS="methodname"
>operator()</CODE
> no histogramming
                    will be done on that event.
                </P
><P
>&#13;                    A common mistake for implementors of event processors
                    is to forget to return a value.  This can result in randomly
                    and silently dropping events as return value will be
                    not well defined.
                </P
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
><code
class="methodsynopsis"
>&#13;  <span
class="modifier"
>virtual  </span
><span
class="modifier"
> </span
><span
class="type"
>Bool_t  </span
>operator()(<span
class="methodparam"
><span
class="modifier"
>const </span
><span
class="type"
> Address_t  </span
><span
class="parameter"
>pEvent</span
></span
><span
class="methodparam"
>, <span
class="type"
>CEvent&#38;  </span
><span
class="parameter"
>rEvent</span
></span
><span
class="methodparam"
>, <span
class="type"
>CAnalyzer&#38;  </span
><span
class="parameter"
>rAnalyzer</span
></span
><span
class="methodparam"
>, <span
class="type"
>CBufferDecoder&#38;  </span
><span
class="parameter"
>rDecoder</span
></span
>);&#13;</code
></DT
><DD
><P
>&#13;                                This method is called for each physics event.
                                <CODE
CLASS="parameter"
>pEvent</CODE
> points to the raw
                                event data for this event.  <CODE
CLASS="parameter"
>rEvent</CODE
> 
                                is the array like object that stores the parameter values
                                created by the event processing pipeline for this event.
                            </P
><P
>&#13;                                The <CODE
CLASS="parameter"
>rAnalyzer</CODE
> and
                                <CODE
CLASS="parameter"
>rDecoder</CODE
> parameters are
                                not often used but reference the analyzer and
                                buffer decoder objects used to manage event processing
                                for this event data format.
                            </P
></DD
><DT
><code
class="methodsynopsis"
>&#13;  <span
class="modifier"
>virtual  </span
><span
class="modifier"
> </span
><span
class="type"
>Bool_t  </span
>OnAttach(<span
class="methodparam"
><span
class="type"
>CAnalyzer&#38;  </span
><span
class="parameter"
>rAnalyzer</span
></span
>);&#13;</code
></DT
><DD
><P
>&#13;                                Called when the event processor is registered
                                with the event processing pipeline.
                                <CODE
CLASS="parameter"
>rAnalyzer</CODE
> references
                                the analyzer that controls the flow of data
                                analysis through SpecTcl.
                            </P
></DD
><DT
><code
class="methodsynopsis"
>&#13;  <span
class="modifier"
>virtual </span
><span
class="modifier"
> </span
><span
class="type"
> Bool_t  </span
>OnBegin(<span
class="methodparam"
><span
class="type"
>CAnalyzer&#38;  </span
><span
class="parameter"
>rAnalyzer</span
></span
><span
class="methodparam"
>, <span
class="type"
>CBufferDecoder&#38;  </span
><span
class="parameter"
>rDecoder</span
></span
>);&#13;</code
></DT
><DD
><P
>&#13;                                Called when a begin run item is detected.
                                Note that not all data acquisition systems
                                have begin run items, however all NSCL supported
                                data acquisition systems do.
                            </P
><P
>&#13;                                <CODE
CLASS="parameter"
>rAnalyzer</CODE
> and
                                <CODE
CLASS="parameter"
>rDecoder</CODE
> refer to the
                                analyzer and decoder respectively.  The decoder
                                provides services (the run number and title
                                which again may not be available in non NSCL supported
                                data acquisition systems), that may be useful to
                                event processors that choose to implement this
                                method.
                            </P
></DD
><DT
><code
class="methodsynopsis"
>&#13;  <span
class="modifier"
>virtual  </span
><span
class="modifier"
> </span
><span
class="type"
>Bool_t  </span
>OnEnd(<span
class="methodparam"
><span
class="type"
>CAnalyzer&#38;  </span
><span
class="parameter"
>rAnalyzer</span
></span
><span
class="methodparam"
>, <span
class="type"
>CBufferDecoder&#38;  </span
><span
class="parameter"
>rBuffer</span
></span
>);&#13;</code
></DT
><DD
><P
>&#13;                                Called when an end fo run item is encountered.
                                See <CODE
CLASS="methodname"
>OnBegin</CODE
> for
                                more.
                            </P
></DD
><DT
><code
class="methodsynopsis"
>&#13;  <span
class="modifier"
>virtual  </span
><span
class="modifier"
> </span
><span
class="type"
>Bool_t  </span
>OnPause(<span
class="methodparam"
><span
class="type"
>CAnalyzer&#38;  </span
><span
class="parameter"
>rAnalyzer</span
></span
><span
class="methodparam"
>, <span
class="type"
>CBufferDecoder&#38;  </span
><span
class="parameter"
>rDecoder</span
></span
>);&#13;</code
></DT
><DD
><P
>&#13;                                Like <CODE
CLASS="methodname"
>OnBegin</CODE
> but invoked
                                when a  run temporarily pauses.  Note that not all
                                NSCL Supported data acquisition systems support
                                pausing an active run.
                            </P
></DD
><DT
><code
class="methodsynopsis"
>&#13;  <span
class="modifier"
>virtual  </span
><span
class="modifier"
> </span
><span
class="type"
>Bool_t  </span
>OnResume(<span
class="methodparam"
><span
class="type"
>CAnalyzer&#38;  </span
><span
class="parameter"
>rAnalyzer</span
></span
><span
class="methodparam"
>, <span
class="type"
>CBufferDecoder&#38;  </span
><span
class="parameter"
>rDecoder</span
></span
>);&#13;</code
></DT
><DD
><P
>&#13;                                Called when a paused run resumes.
                            </P
></DD
><DT
><code
class="methodsynopsis"
>&#13;  <span
class="modifier"
>virtual  </span
><span
class="modifier"
> </span
><span
class="type"
>Bool_t  </span
>OnOther(<span
class="methodparam"
><span
class="type"
>UInt_t  </span
><span
class="parameter"
>nType</span
></span
><span
class="methodparam"
>, <span
class="type"
>CAnalyzer&#38;  </span
><span
class="parameter"
>rAnalyzer</span
></span
><span
class="methodparam"
>, <span
class="type"
>CBufferDecoder&#38;  </span
><span
class="parameter"
>rDecoder</span
></span
>);&#13;</code
></DT
><DD
><P
>&#13;                                Called when an item type that does not neatly fit
                                into the categories above is encountered.
                                <CODE
CLASS="parameter"
>nType</CODE
> is an item type
                                drawn, where possible, from
                                <TT
CLASS="filename"
>buftype.h</TT
>, and where not,
                                from the underlying DAQ system that produced the
                                data.
                            </P
></DD
><DT
><code
class="methodsynopsis"
>&#13;  <span
class="modifier"
>virtual  </span
><span
class="modifier"
> </span
><span
class="type"
>Bool_t  </span
>OnEventSourceOpen(<span
class="methodparam"
><span
class="type"
>std::string  </span
><span
class="parameter"
>name</span
></span
>);&#13;</code
></DT
><DD
><P
>&#13;                                Called when a new event source is opened.
                                <CODE
CLASS="parameter"
>name</CODE
> is a data source type
                                dependent parameter that identifies what the
                                data source is connected to.
                            </P
></DD
><DT
><code
class="methodsynopsis"
>&#13;  <span
class="modifier"
>  virtual  </span
><span
class="modifier"
> </span
><span
class="type"
>Bool_t  </span
>OnEventSourceEOF();&#13;</code
></DT
><DD
><P
>&#13;                                Called when the event source hits the end of data.
                                For file data sources this means that the  data
                                in the file has been completely processed.
                                For Pipe data sources, this means that the
                                producer end of the pipe has closed the pipe.
                            </P
></DD
><DT
><code
class="methodsynopsis"
>&#13;  <span
class="modifier"
>virtual  </span
><span
class="modifier"
> </span
><span
class="type"
>Bool_t  </span
>OnInitialize();&#13;</code
></DT
><DD
><P
>&#13;                                This is called when SpecTcl is initialized.
                                For event processors registered in
                                <CODE
CLASS="classname"
>MySpecTclApp</CODE
>::<CODE
CLASS="methodname"
>CreateAnalysisPipeline</CODE
>,
                                this is sometime after registration when SpecTcl
                                has been completely intialized.  For those
                                registered dynamically, later,
                                <CODE
CLASS="methodname"
>OnInitialize</CODE
> is called
                                immediately after
                                <CODE
CLASS="methodname"
>OnAttach</CODE
>.
                            </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="p8474.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="r8671.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Core SpecTcl classes</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="p8474.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>CEventBuilderEventProcessor</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>